
================================================================================
GUIA DE CORRE√á√ÉO COMPLETA - 97 ERROS/FALHAS NOS TESTES
================================================================================

üìä RESUMO EXECUTIVO:
- 61 ERRORS (erros de c√≥digo/sintaxe)
- 36 FAILS (expectativas erradas)
- Total: 97 problemas

================================================================================
üî¥ CORRE√á√ÉO 1: IntegrityError - Chave Duplicada E1 (28 ERRORS)
================================================================================

PROBLEMA:
M√∫ltiplos testes tentando criar Eixo com stralias='E1', violando constraint UNIQUE

ARQUIVO: acoes_pngi/tests/test_api_views_alinhamento_responsaveis.py
LINHAS: ~151, ~542 (em setup_test_data)

CAUSA:
    self.eixo = Eixo.objects.create(
        stralias='E1',
        strdescricaoeixo='Eixo 1 - Gest√£o'
    )

SOLU√á√ÉO - Substituir por get_or_create():

    self.eixo, _ = Eixo.objects.get_or_create(
        stralias='E1',
        defaults={'strdescricaoeixo': 'Eixo 1 - Gest√£o'}
    )

ARQUIVOS AFETADOS:
‚úì test_api_views_alinhamento_responsaveis.py (classe TipoAnotacaoAlinhamentoAPITests)
‚úì test_api_views_alinhamento_responsaveis.py (classe UsuarioResponsavelAPITests)

TESTES CORRIGIDOS COM ISSO: 28

================================================================================
üî¥ CORRE√á√ÉO 2: AttributeError - setup_test_data (30 ERRORS)
================================================================================

PROBLEMA:
AttributeError: 'EixoWebViewsTests' object has no attribute 'setuptestdata'
Did you mean: 'setUpTestData'?

Python √© case-sensitive! Django espera setUpTestData (com mai√∫sculas TD)

ARQUIVO: acoes_pngi/tests/test_views.py
CLASSES AFETADAS:
- EixoWebViewsTests
- VigenciaWebViewsTests  
- SituacaoAcaoWebViewsTests

CAUSA:
    def setUp(self):
        self.setup_test_data()  # ‚ùå ERRADO

    def setup_test_data(self):  # ‚ùå m√©todo com nome errado
        # c√≥digo...

SOLU√á√ÉO - Op√ß√£o A (Recomendada):

    def setUp(self):
        # Mover c√≥digo de setup_test_data aqui
        self.factory = RequestFactory()
        # ... resto do c√≥digo

SOLU√á√ÉO - Op√ß√£o B (Manter m√©todo separado):

    def setUp(self):
        self.setUpTestData()  # ‚úÖ Capitaliza√ß√£o correta

    @classmethod
    def setUpTestData(cls):  # ‚úÖ M√©todo de classe correto
        # c√≥digo...

TESTES CORRIGIDOS COM ISSO: 30

================================================================================
üü° CORRE√á√ÉO 3: TypeError - date() com 4 argumentos (2 ERRORS)
================================================================================

PROBLEMA:
TypeError: date() function takes at most 3 arguments (4 given)

ARQUIVO: acoes_pngi/tests/test_api_acoes_views.py
LINHA: ~164 (test_filter_acoes_by_vigencia)

CAUSA:
    dat_inicio_vigencia=date(2027, 1, 1, ???)  # 4¬∫ argumento extra
    dat_final_vigencia=date(2027, 12, 31, ???)

SOLU√á√ÉO:

    dat_inicio_vigencia=date(2027, 1, 1)  # ‚úÖ Apenas 3 argumentos
    dat_final_vigencia=date(2027, 12, 31)

TESTES CORRIGIDOS COM ISSO: 2

================================================================================
üü° CORRE√á√ÉO 4: IndexError - List Index Out of Range (4 ERRORS)
================================================================================

PROBLEMA:
IndexError: list index out of range
Tentando acessar results[0] quando lista est√° vazia

ARQUIVO: acoes_pngi/tests/test_api_alinhamento_views.py
LINHAS: ~440, ~453, ~178

TESTES AFETADOS:
- test_ordering_anotacoes
- test_ordering_anotacoes_ascending
- test_ordering_tipos

CAUSA:
    results = response.data['results']
    self.assertEqual(results[0]['dat_data_anotacao_alinhamento'], ...)  # ‚ùå

SOLU√á√ÉO:

    results = response.data['results']
    self.assertTrue(len(results) > 0, "Nenhum resultado retornado")  # ‚úÖ Validar
    self.assertEqual(results[0]['dat_data_anotacao_alinhamento'], ...)

TESTES CORRIGIDOS COM ISSO: 4

================================================================================
üü° CORRE√á√ÉO 5: AttributeError - .get() em ReturnList (2 ERRORS)
================================================================================

PROBLEMA:
AttributeError: 'ReturnList' object has no attribute 'get'

ARQUIVO: acoes_pngi/tests/test_diagnostic_api_fixed.py
LINHAS: ~175, ~281

CAUSA:
    len(response.data.get('results', []))  # ‚ùå ReturnList n√£o tem .get()

SOLU√á√ÉO - Op√ß√£o A (response.data √â a lista):

    len(response.data)  # ‚úÖ Se response.data j√° √© ReturnList

SOLU√á√ÉO - Op√ß√£o B (response.data √â dict):

    len(response.data['results'])  # ‚úÖ Se data √© dict com chave 'results'

SOLU√á√ÉO - Op√ß√£o C (Defensiva):

    results = getattr(response.data, 'results', response.data)
    len(results)

TESTES CORRIGIDOS COM ISSO: 2

================================================================================
üü¢ CORRE√á√ÉO 6: Falhas de Permiss√£o (36 FAILS)
================================================================================

PROBLEMA:
Testes esperam que COORDENADOR N√ÉO possa fazer opera√ß√µes, mas o c√≥digo permite

MODELOS AFETADOS:
- Eixo (test_coordenador_cannot_create/update/delete_eixo)
- Vigencia (test_coordenador_cannot_create/update/delete_vigencia)
- SituacaoAcao (test_coordenador_cannot_X)
- TipoAnotacaoAlinhamento (test_coordenador_can_X mas deveria ser cannot)

DECIS√ÉO NECESS√ÅRIA:
Escolha UMA das op√ß√µes:

OP√á√ÉO A: COORDENADOR DEVE TER PERMISS√ïES (Alterar testes)
    Mudar expectativas dos testes:
    - test_coordenador_cannot_create_eixo ‚Üí test_coordenador_can_create_eixo
    - Alterar status esperado: 403 ‚Üí 201/200/204

OP√á√ÉO B: COORDENADOR N√ÉO DEVE TER PERMISS√ïES (Alterar c√≥digo)
    Adicionar IsGestorPNGI nas views:

    class EixoViewSet(viewsets.ModelViewSet):
        permission_classes = [IsAuthenticated, IsGestorPNGI]  # ‚úÖ Adicionar

    class VigenciaViewSet(viewsets.ModelViewSet):
        permission_classes = [IsAuthenticated, IsGestorPNGI]  # ‚úÖ Adicionar

MATRIZ DE PERMISS√ïES ATUAL (baseado nos testes passando):
+------------------------+--------+-------------+-----------+-----------+
| Opera√ß√£o               | GESTOR | COORDENADOR | OPERADOR  | CONSULTOR |
+------------------------+--------+-------------+-----------+-----------+
| Eixo (CRUD)            | ‚úÖ      | ‚úÖ (bug?)   | ‚ùå         | ‚ùå         |
| Vigencia (CRUD)        | ‚úÖ      | ‚úÖ (bug?)   | ‚ùå         | ‚ùå         |
| SituacaoAcao (CRUD)    | ‚úÖ      | ‚úÖ (bug?)   | ‚ùå         | ‚ùå         |
| TipoEntraveAlerta      | ‚úÖ      | ‚ùå          | ‚ùå         | ‚ùå         |
| TipoAnotacao (CRUD)    | ‚úÖ      | ‚úÖ          | ‚ùå         | ‚ùå         |
+------------------------+--------+-------------+-----------+-----------+

RECOMENDA√á√ÉO: Op√ß√£o B (IsGestorPNGI) - Consist√™ncia com TipoEntraveAlerta

TESTES AFETADOS COM ISSO: 36

================================================================================
üìã PLANO DE A√á√ÉO SEQUENCIAL
================================================================================

PASSO 1: Corre√ß√µes Cr√≠ticas (Bloqueiam 58 testes)
    ‚úì Corre√ß√£o 1: IntegrityError E1
    ‚úì Corre√ß√£o 2: AttributeError setup_test_data

PASSO 2: Corre√ß√µes de Bugs (8 testes)
    ‚úì Corre√ß√£o 3: TypeError date()
    ‚úì Corre√ß√£o 4: IndexError list
    ‚úì Corre√ß√£o 5: AttributeError .get()

PASSO 3: Corre√ß√µes de Permiss√µes (36 testes) - REQUER DECIS√ÉO
    ‚úì Corre√ß√£o 6: Revisar matriz de permiss√µes

================================================================================
üöÄ COMANDOS PARA TESTAR CADA CORRE√á√ÉO
================================================================================

# Teste 1: IntegrityError E1
python manage.py test acoes_pngi.tests.test_api_views_alinhamento_responsaveis -v 2

# Teste 2: AttributeError setup_test_data  
python manage.py test acoes_pngi.tests.test_views.EixoWebViewsTests -v 2
python manage.py test acoes_pngi.tests.test_views.VigenciaWebViewsTests -v 2
python manage.py test acoes_pngi.tests.test_views.SituacaoAcaoWebViewsTests -v 2

# Teste 3: TypeError date()
python manage.py test acoes_pngi.tests.test_api_acoes_views.AcoesViewSetTest.test_filter_acoes_by_vigencia -v 2

# Teste 4: IndexError list
python manage.py test acoes_pngi.tests.test_api_alinhamento_views -v 2

# Teste 5: AttributeError .get()
python manage.py test acoes_pngi.tests.test_diagnostic_api_fixed -v 2

# Teste TODOS ap√≥s corre√ß√µes
python manage.py test acoes_pngi -v 2

================================================================================
